{% extends "base.html" %} {% block content %}

<div class="card portfolio-table" id="table-card" style="border-width: 0; background-color: rgba(255, 255, 255, 0);">
    <div class="card-body text-center" style="box-shadow: 0 0 9px rgba(0, 0, 0, 0.42); border-radius: 8px; background-color: #287271; margin-top: 27px;">
        <div>
            <h1 style="color: rgb(255, 250, 246);">Your portfolio</h1>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr style="color: rgb(255, 236, 209); font-size: 16px; font-family: 'Montserrat Alternates', sans-serif; font-weight: normal;">
                        <th style="width: 156px;">Symbol</th>
                        <th>Stock</th>
                        <th style="width: 171px;">&nbsp;Quantity</th>
                        <th style="width: 173px;">Value ($)</th>
                        <th style="width: 169px;">Profit/Loss ($)</th>
                        <th style="width: 200px;">Change from buy (%)</th>
                        <th style="width: 42px; max-width: 37px;"></th>
                    </tr>
                </thead>

                {% for stock in stocks %}
                    {% set stock_data = stock.get_stock_data() %}
                    {% set stock_yield = Stock.get_yield_of_single_stock(stock) %}
                    {% set profit_prec = stock_yield['profit_prec'] %} {% set profit_in_usd =stock_yield['profit_in_usd'] %}

                    <tbody style="background-color: #fffaf6;">
                        <tr class="text-nowrap">
                            <td class="text-uppercase"><img class="stock-img" src="{{ stock_data["logo"] }}"  alt=""/> {{ stock_data['stock_symbol'] }}</td>
                            <td>{{ stock_data['full_name'] }}</td>
                            <td>{{ stock_data['shares'] }}</td>
                            <td>{{ stock_yield['total_value'] }}</td>
                            <td style="color: rgb(117, 191, 111); font-size: 16px;">{{ '$+' + profit_in_usd|string if profit_in_usd > 0 else '$' + profit_in_usd|string }}</td>
                            <td style="color: rgb(117, 191, 111);">{{ '+' + profit_prec|string + '%' if profit_prec > 0 else profit_prec|string + '%' }}</td>
                            <td></td>
                        </tr>
                    </tbody>
                {% endfor %}
            </table>

        </div>
        <div style="text-align: right;">
            <div class="text-center" id="modal-open">
                <div class="modal fade" role="dialog" tabindex="-1" id="exampleModal" aria-labelledby="exampleModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Add a Stock</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                            </div>
                            <div class="modal-body">

                                <form method="post" action="add_stock">
                                    <div class="text-left" style="margin-top: 20px;">
                                        <span><i class="icon ion-ios-pricetags"></i> {{ form.stock_symbol.label() }}</span>
                                        {{ form.stock_symbol(class="form-control", type="text", id="stock-symbol", style="margin-bottom: 12px; margin-top: 3px;", required="", autofocus="", minlength="1") }}
                                    </div>

                                    <div class="text-left" style="margin-top: 20px;">
                                        <span><i class="fas fa-dollar-sign"></i> {{ form.purchase_price.label() }}</span>
                                        {{ form.purchase_price(class="form-control", type="text", id="price-at-purchase", style="margin-bottom: 12px; margin-top: 3px;", required="", minlength="1") }}
                                    </div>

                                    <div class="text-left" style="margin-top: 20px;">
                                        <span><i class="fas fa-hashtag"></i> {{ form.num_of_shares.label() }}</span>
                                        {{ form.num_of_shares(class="form-control", type="text", id="num-of-shares", style="margin-bottom: 12px; margin-top: 3px;", required="", minlength="1") }}
                                    </div>

                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-warning" data-dismiss="modal" id="close-modal-btn" type="button">Close</button>
                                <button>{{ form.submit(class="btn", id="add-stock-btn", type="submit") }}</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-light text-dark" data-toggle="modal" data-target="#exampleModal" type="submit" style="margin-top: 20px; background-color: rgb(251, 212, 109);">Add Stock</button>
            </div>
        </div>
    </div>
</div>
{% endblock content %}


